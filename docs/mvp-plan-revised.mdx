# Location-Based Privacy Social Media MVP Plan (SIMPLIFIED)

## Project Overview

**Vision**: A privacy-respecting, location-based social media platform that integrates with the ActivityPub protocol for decentralized federation.

**Timeline**: 8 weeks (2 months)
**Team Size**: 6 members  
**Weekly Commitment**: 10 hours per person

Note: This is a student project, goal is minimum viable project which shows best software engineering practices. It is not meant for production.

## Major Tools Used
- PostgreSQL
- Django
- Fedify
- React
- Nginx
- Docker

## Simplified System Architecture

```mermaid
graph TB
    %% User Layer
    User[👤 User Browser]
    
    %% Frontend Layer
    subgraph "Frontend (React)"
        UI[React App]
        Router[React Router]
        Leaflet[Leaflet Maps]
    end

    %% Nginx Reverse Proxy
    Nginx[Nginx<br/>Reverse Proxy<br/>:80/:443]

    %% Backend Services on EC2
    subgraph "EC2 Instance"
        subgraph "Django Service :8001"
            API[REST API]
            Auth[Authentication]
            Models[Models & ORM]
            AsyncViews[Async Views<br/>for notifications]
        end
        
        subgraph "Fedify Service :8000"
            AP[ActivityPub Handler]
            Webfinger[Webfinger]
            Signatures[HTTP Signatures]
        end
        
        subgraph "Database"
            PG[(PostgreSQL<br/>Regular Tables)]
        end
    end

    %% Federation Network
    subgraph "Fediverse"
        Mastodon[Mastodon Instances]
        Other[Other ActivityPub Servers]
    end

    %% User Flow
    User -->|HTTPS| UI
    UI -->|API Calls| Nginx

    %% Nginx Routing
    Nginx -->|/api/*| API
    Nginx -->|/.well-known/*<br/>/users/*<br/>/inbox/*| AP
    Nginx -->|Static Files| UI

    %% Internal Communication
    API --> Auth
    API --> Models
    Models --> PG
    API -->|Notify Federation| AP
    AsyncViews -->|Email/Notifications| User

    %% Federation Flow
    AP <-->|ActivityPub Protocol| Mastodon
    AP <-->|ActivityPub Protocol| Other
    AP -->|Store Remote Data| PG
    AP -->|Get Local Data| PG

    %% Deployment
    GitHub[GitHub Repo]
    GitHub -->|SSH Deploy<br/>on push to main| EC2

    %% Styling
    classDef frontend fill:#61dafb,stroke:#333,stroke-width:2px
    classDef backend fill:#092e20,stroke:#333,stroke-width:2px,color:#fff
    classDef federation fill:#6f42c1,stroke:#333,stroke-width:2px,color:#fff
    classDef database fill:#336791,stroke:#333,stroke-width:2px,color:#fff
    classDef infra fill:#ff9900,stroke:#333,stroke-width:2px
    classDef external fill:#28a745,stroke:#333,stroke-width:2px,color:#fff

    class UI,Router,Leaflet frontend
    class API,Auth,Models,AsyncViews backend
    class AP,Webfinger,Signatures federation
    class PG database
    class Nginx,EC2,GitHub infra
    class Mastodon,Other external
```

## Data Flow Examples

### User Creates a Post
```mermaid
sequenceDiagram
    participant U as User
    participant R as React
    participant N as Nginx
    participant D as Django
    participant DB as PostgreSQL
    participant F as Fedify
    participant EX as External Server

    Note over U,EX: User Creates Post
    U->>R: Create post
    R->>N: POST /api/posts
    N->>D: Route to Django
    D->>DB: Save post
    D->>F: Trigger federation
    D->>R: Return success
    F->>DB: Get post data
    F->>EX: Deliver to followers
```

### External User Follows Local User
```mermaid
sequenceDiagram
    participant EX as External Server
    participant N as Nginx
    participant F as Fedify
    participant DB as PostgreSQL

    Note over EX,DB: External Follow Request
    EX->>N: POST /users/alice/inbox
    N->>F: Route to Fedify
    F->>F: Verify signature
    F->>DB: Store follow
    F->>EX: Send Accept
```

## Deployment Flow

```mermaid
graph LR
    Dev[Developer] -->|git push| GH[GitHub]
    GH -->|webhook| GA[GitHub Actions]
    GA -->|Run Tests| Test{Tests Pass?}
    Test -->|No| Fail[❌ Block Deploy]
    Test -->|Yes| SSH[SSH to EC2]
    SSH -->|git pull| Code[Update Code]
    Code -->|restart| Services[Restart Services]
    Services --> Live[✅ Live Site]

    style Fail fill:#ff6b6b
    style Live fill:#51cf66
```

## Simplified Technical Stack

### Frontend
- **Framework**: React 18 with Vite
- **State Management**: React Context API
- **Routing**: React Router v6
- **Styling**: Tailwind CSS
- **Maps**: Leaflet (for location picking)

### Backend
- **Framework**: Django + Django REST Framework
- **Database**: PostgreSQL 15 (no PostGIS needed)
- **Authentication**: Django's built-in auth + JWT
- **Async Tasks**: Django async views
- **Email**: SMTP with free tier service (SendGrid/Gmail)

### Federation
- **Framework**: Fedify (Node.js ActivityPub framework)
- **Runtime**: Node.js 20
- **Signatures**: Built into Fedify
- **Webfinger**: Built into Fedify

### Infrastructure
- **Hosting**: Single EC2 t3.small instance
- **Database**: PostgreSQL on same EC2 (or RDS free tier)
- **Reverse Proxy**: Nginx
- **CI/CD**: Simple GitHub Actions SSH deployment
- **Development**: Docker Compose (local only)

## Service Responsibilities

### Django Handles (User-Facing Features)
- User registration and authentication
- Post creation, editing, deletion
- Following/follower relationships
- Feed generation
- User profiles and settings
- Privacy controls
- Location tagging (simple city/region strings)
- REST API for React frontend
- Email notifications (async views)

### Fedify Handles (Federation Protocol Only)
- ActivityPub protocol implementation
- Converting Django posts to ActivityPub format
- Receiving and validating external activities
- HTTP signature verification
- Webfinger user discovery
- Delivering activities to remote servers
- NO business logic - just protocol translation

## Revised MVP Scope

### Phase 1: Core Social Features (Weeks 1-6)
- User authentication and profiles
- Text posts with optional location tags (city-level)
- Following system
- Chronological feed
- Basic privacy controls (public/followers-only)
- Simple location filtering

### Phase 2: Federation (Weeks 7-8)
- ActivityPub integration via Fedify
- Follow external users
- Receive posts from followed external users
- Basic federation testing

## Location Privacy Implementation

### Simple Privacy-First Design:
```python
# No PostGIS needed - just simple fields
class Post(models.Model):
    content = models.TextField()
    author = models.ForeignKey(User, on_delete=models.CASCADE)
    
    # Location as simple strings
    city = models.CharField(max_length=100, blank=True)
    region = models.CharField(max_length=100, blank=True)
    country = models.CharField(max_length=2, blank=True)  # ISO code
    
    # Privacy settings
    location_privacy = models.CharField(choices=[
        ('none', 'No Location'),
        ('country', 'Country Only'),
        ('region', 'State/Region'),
        ('city', 'City Level'),
    ], default='none')
    
    visibility = models.CharField(choices=[
        ('public', 'Public'),
        ('followers', 'Followers Only'),
        ('private', 'Private'),
    ], default='public')
    
    created_at = models.DateTimeField(auto_now_add=True)
    expires_at = models.DateTimeField(null=True)  # Optional auto-delete
```

## Sprint Breakdown (8 Weeks)

### Sprint 1 (Weeks 1-2): Foundation
**Goal**: Basic infrastructure and authentication

**Tasks**:
- EC2 instance setup with Nginx
- PostgreSQL installation and configuration
- Django project with user authentication
- React app with login/register
- Simple GitHub Actions deployment
- Docker Compose for local development

**Deliverable**: Users can register and log in

### Sprint 2 (Weeks 3-4): Core Social Features
**Goal**: Basic social functionality

**Tasks**:
- Post creation and viewing
- User profiles
- Following system
- Simple chronological feed
- React UI for all features

**Deliverable**: Users can post and follow each other

### Sprint 3 (Weeks 5-6): Location & Privacy
**Goal**: Location features with privacy controls

**Tasks**:
- Location fields on posts (city/region picker)
- Privacy settings UI
- Location-based post filtering
- Visibility controls (public/followers)
- Feed filtering by location

**Deliverable**: Location-aware social platform

### Sprint 4 (Weeks 7-8): Federation
**Goal**: Basic ActivityPub support

**Tasks**:
- Fedify setup and configuration
- Webfinger endpoint
- Actor profiles
- Basic inbox/outbox
- Follow external users
- Receive external posts
- Federation testing with Mastodon

**Deliverable**: Can interact with the Fediverse

## Team Roles

### Frontend Developer
- React UI implementation
- State management
- API integration
- Responsive design
- Location picker component

### Backend Developer
- Django REST API
- Database models
- Authentication
- Privacy logic
- Django-Fedify communication

### Federation Developer
- Fedify setup
- ActivityPub implementation
- Federation testing
- Protocol compliance

### DevOps/Infrastructure
- EC2 setup
- Nginx configuration
- PostgreSQL administration
- CI/CD pipeline
- Docker development environment

## Infrastructure Setup

### Development Environment (Docker Compose)
```yaml
version: '3.8'

services:
  django:
    build: ./django
    ports:
      - "8001:8001"
    environment:
      - DATABASE_URL=postgresql://user:pass@postgres:5432/db
    volumes:
      - ./django:/app

  fedify:
    build: ./fedify
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://user:pass@postgres:5432/db

  postgres:
    image: postgres:15
    environment:
      - POSTGRES_DB=socialmedia
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=pass

  react:
    build: ./frontend
    ports:
      - "3000:3000"
    volumes:
      - ./frontend:/app
```

### Production Deployment (EC2)
- Install services directly on EC2 (no Docker in production)
- Use systemd for process management
- Nginx for reverse proxy
- Simple bash script deployment

### CI/CD Pipeline (GitHub Actions)
```yaml
name: Deploy
on:
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Run Tests
        run: |
          # Django tests
          cd django && python manage.py test
          # React tests
          cd ../frontend && npm test

  deploy:
    needs: test
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to EC2
        uses: appleboy/ssh-action@v0.1.5
        with:
          host: ${{ secrets.EC2_HOST }}
          username: ubuntu
          key: ${{ secrets.EC2_SSH_KEY }}
          script: |
            cd /home/ubuntu/project
            git pull
            ./deploy.sh
```

## Realistic Success Metrics

### Must-Have (MVP Requirements)
- [ ] User registration and authentication
- [ ] Create and view text posts
- [ ] Follow other users
- [ ] View follower-only feed
- [ ] Add city-level location to posts
- [ ] Basic privacy controls
- [ ] Federation: Follow at least one Mastodon user
- [ ] Federation: Receive posts from external users

### Nice-to-Have
- [ ] Mobile responsive design
- [ ] Post editing/deletion
- [ ] User search
- [ ] Email notifications
- [ ] Media uploads
- [ ] More granular privacy controls

## Risk Mitigation

### Simplified Approaches
1. **No PostGIS**: Use simple string fields for location
2. **No Celery/Redis**: Use Django async views
3. **No AWS complexity**: Single EC2 instance
4. **No Docker in production**: Direct installation is simpler
5. **Minimal federation**: Just following and receiving posts

### Contingency Plans
- **Week 6 checkpoint**: If behind schedule, skip federation
- **Location complexity**: Start with just city names, no geographic queries
- **Federation issues**: Can demo with local test instance
- **Performance issues**: Don't worry about optimization for MVP

## Budget Estimate

### Monthly Costs
- **EC2 t3.small**: $15/month
- **Domain name**: $1/month (amortized)
- **Total**: ~$20/month

### Free Services
- GitHub (code hosting)
- SendGrid/Gmail (email)
- Let's Encrypt (SSL)
- Cloudflare (optional CDN)

## Next Steps

1. **Day 1**: Set up GitHub repo and project board
2. **Day 2**: Provision EC2 and install basic services  
3. **Day 3**: Create Django and React skeleton projects
4. **Day 4**: Set up CI/CD pipeline
5. **Week 1**: Complete Sprint 1 goals

## Key Simplifications from Original Plan

1. **Infrastructure**: Single EC2 instead of complex AWS setup
2. **Database**: Plain PostgreSQL instead of PostGIS
3. **Background Jobs**: Django async views instead of Celery+Redis
4. **Deployment**: Simple SSH script instead of complex CI/CD
5. **Docker**: Development only, not production
6. **Timeline**: Realistic 8 weeks instead of unclear 8-12 weeks
7. **Location**: String fields instead of geographic coordinates
8. **Monitoring**: Basic logs instead of CloudWatch/Grafana

This simplified plan focuses on delivering a working MVP that demonstrates both social media features and federation capabilities without getting bogged down in infrastructure complexity.